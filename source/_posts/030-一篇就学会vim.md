---
layout: post
title: 一篇就学会vim
date: 2022-09-14
toc: true
category:
    服务端
tags:
    vim
---
![vim](https://cdn.staticaly.com/gh/liugezhou/image@master/blog/blog-vim.webp)

<!--more-->
学会一个软技能，总结一篇文章就够了。  
剩下要做的就是不停的练习，不停的尝试，本文是在学习[这个仓库](https://github.com/wsdjeg/Learn-Vim_zh_cn)之后的极简总结中。 
主要作为一个备忘录使用。   

长期更新。。。

### 一、Vim基础介绍
1. `vim`           看到一个介绍页面
2. `i`              进入编辑模式
3. `:`              光标将移动到屏幕底部，在这里您可以输入命令
4. `Esc`            切回普通模式  
5. `:quit`          退出编辑模式,简写为:q     
6. `:write `        保存模式，简写为:w    
7. `:w f.md`        如果是新建的一个没有名字的文件，以f为名字保存文件  
9. `:wq`            保存退出  
10. `:q!`           不保存修改而强制退出  
11. `:h`            在冒号模式下，输入 :h quit 然后按Tab键就会自动打出命令。  
12. `:vim f1 f2`    通过vim命令在不同的buffers中打开多个文件  
13. `vim --version`  '+'表示支持的特性，'-'表示不支持的特性  
14. `vim +%s hello/liugezhou/g file `  这条命令的意思是 打开file文件将文档中所有的hello改为liugezhou  
15. `vim -o2`       水平打开n个窗口
16. `vim -O2`       垂直打开n个窗口 
17. `Ctrl + z(:stop :suspend)`      使用vim打开的文件进行挂起 输入fg恢复。  

### 二、Buffers、Windows、Tabs  

 创建一个.vimrc,添加配置`set hidden`（切换buffer且当前buffer没有保存，不会进行提示）

 #### 2.1 buffers
1. vim file1.js file2.js,实际创建了两个buffers，执行完该命令后展示的是file1.js的buffers 
   运行:buffers命令可以查看所有的buffers,或者使用 `:ls` OR `:files`命令查看。   
2. 切换到下一个buffer `:bnext` 、`:buffer fileName`、`buffer n` 
3. 切换到下一个buffer的快捷键:`Ctrl + I`,切换到原来buffer的快捷键:`Ctrl + O`  
4. 一旦buffer创建成功，即进入了buffers列表，这个时候想在buffers列表中删除某一个buffer，直接`:bdelete n`即可 
5. 退出vim
  - 关闭所有buffer `:qall`  
  - 关闭所有buffer但是不保存 `qall!`  
  - 关闭所有buffer且保存 `wqall`

#### 2.2 Windows
1. vim file1.txt打开file1文件，有一个buffer，有一个窗口 
   此时在vim中使用`:split file2.txt` 会看到此刻有两个窗口，两个buffer，file2.txt的窗口在上  
   如果想垂直打开file2窗口  `:vsplit file2.txt`
   如果想垂直打开一个新命名文件的窗口  :`vsplit filename`
2. 如果要在窗口直接导航  
    `Ctrl+ W  h` 左移窗口
    `Ctrl+ W  l` 右移窗口
    `Ctrl+ W  j` 下移窗口
    `Ctrl+ W  k` 上移窗口
3. 继续输入 `:split file3.txt`,此时有三个窗口、三个buffer   
4. 如果想在显示file2.txt的窗口中显示file3.txt，只需要在当前buffer为2下输入`:buffer file3.txt`即可 
5. 要关闭当前窗口  `Ctrl+W c` 
6. 普通模式下关于窗口的命令： 
  `Ctrl + W c` 打开一个垂直分割的窗口
  `Ctrl + W s` 打开一个水平分割的窗口
  `Ctrl + W c` 关闭当前所在窗口 
  `Ctrl + W o` 除了当前窗口，关闭其它所有窗口
  
#### 2.3 Tabs 
1. vim tabs.md  这个时候打开一个新tab，使用命令 `:tabnew readme.md` 
2. 切换下一个tab，使用命令 `:tabnext` 
3. 关闭当前tab，使用命令`:tabclose` 
4. 切换上一个tab，使用命令`:tabprevious`
5. 切换至最后一个tab，使用命令`:tablast`  
6. 切换至第一个tab，使用命令`:tabfirst` 
7. 如果想让vim启动时就包含多个tabs，可以使用命令 `vim -p file1.txt file2.txt`

### 三、打开和搜索文件
#### 3.1 打开和编辑文件
- 要在vim中打开一个文件，直接使用命令 `:edit newFile` 
- edit接收通配符*，比如使用 `:edit *.md`然后按tab键，就会依次显示md文件，还可以是`*/*.js`这种格式 
- `:edit 路径URL`也可以直接打开一个文件

#### 3.2 使用find命令搜索文件
- 比如：我试了一下`:find readme.md`就直接跳转到那个文件了，但是这里只是找之前buffers中存在的
- 通过 find的命令会直接跳转到找到的那个文件，且在当前窗口打开

#### 3.3 find和Path的区别
- `:find`命令根据path选项配置的路径去找文件  
- `:edit`命令则不会。
在我们开始牛逼的使用`find`命令前，我们需要对`path`到底是什么进行一个学习

- `:set path?`这个命令，可以让我们看一下我们的path是什么，在当前这个文件(使用vim写)，输入此命令，显示内容为：`path=.,/usr/include,,`  

#### 3.4 使用grep命令在文件中搜索

**内置grep**
- grep是指在文件内容进行内容的查找,  `:vim /pattern/ file` pattern为正则表达式  
- 搜索出来后默认显示出第一条匹配内容  
- 查看所有搜索内容:`:copen` 
- 关闭窗口:`:cclose`  
- 跳到下一个列表: `cnext` 
- 跳到上一个列表： `cprevious`

**外置grep**
- 在命令行终端搜索  
- grep -R "搜索的内容"  fileUrl

**用Netrw浏览文件**
- Netrw是vim内置的文件浏览器、查看项目的目录结构时很有用。  
- 要运行Netrw，需要在`.vimrc`中配置  
```
set nocp
filetype plugin on
``` 
- 这个时候 vim直接给一个地址就可以了  
- 要从内部运行Netrw，则需要给`:edit`一个目录地址  

#### 3.5 vim中文件内容搜索
- normal模式(即Esc模式) 
- 直接输入`/`或者`?`，然后输入要搜索的字符进行搜索 
- 注意区别是:   
  - `/`是从光标处向下查找，这个时候输入`n` 是继续查找下一个，输入`N`是查找上一个    
  - `?`是从光标处向上查找,这个时候输入`n`是继续向上查找，输入`N`是向下开始查找

彩蛋:item2的光标样式设置为`Profiles -> Colors -> Cursor colors -> Cursor`进行设置 
然后在vim搜索中还是不明显，这个时候将`Profiles -> Colors -> Cursor colors ->Cursor guide`勾选上就好很多了。 

### 四、Vim语法 
#### 4.1 ⭐️ vim语言的语法规则  动词 + 名词  

动词是动作
- y  复制   
- p  粘贴到光标后
- P  粘贴到光标前
- d  删除文本 
- c  删除文本，与d不同的是--将删除的文本保存在寄存器中，从普通模式进入到插入模式

名词是位置
- h  左  
- l  右 
- j  下 
- k  上  
- $  当前行的末尾 
- w  下一个单词的开头 
- }  跳转到下一个段落 
#### 4.2 结合
- y$:复制当前位置到行尾的所有内容 
- dw:删除当前位置到下一个单词开头的内容 
- c}:修改当前位置到段落结尾的内容。

#### 4.3 更多名词
- 如何更快的把括号中内容删除：`I want say (hello vim)`?  
- 文本对象：小括号中、中括号、大括号、引号    
- 文本对象可以被操作符operations使用，两类文本对象分别为：`i + object`  `a + object`  
- `di(` 删除`()`内的内容  
- 删除整个被`{}`包裹的内容：`di{` 
- 删除`hello`这个单词：在`h`这个字母上，使用命令：`diw` 

```
<div>
  <h1>Header1</h1>
  <p>Paragraph1</p>
  <p>Paragraph2</p>
</div>
```
1. 若此时光标在Header1上  
2. 删除Header1这个单词：`dit` 
3. 删除`<h1>Header1</h1>`:`dat` 

#### 4.4 常用到的文本对象
- `w`: 一个单词   
- `p`: 一个段落   
- `s`: 一个句子   
- `(`或者`)`:指的是`()` 
- `{`或者`}`:指的是`{}` 
- `<`或者`>`:指的是一对`<>` 
- `t`: XML标签   

#### 4.5 针对性复习
- `w` or `W`: 跳转到下一个单词  
- `$`: 跳转到本行的行尾 
- `{`: 跳转到打开文件光标所在位置的段落最开始 
- `}`: 跳转到打开文件光标所在位置的段落最末尾 
- `G`: 跳转到打开文件的最后一行的开始位置
- `nG`: 跳转到第n行

- `d`: 删除操作符 
- `y`: 复制操作符 
- `c`: 删除插入操作符
- `p`: 粘贴到光标后操作符 
- `gU`: 小写变大写操作符  


### 五、在文件中移动

#### 5.1 ⭐️ 字符导航
普通模式下：
- `hjkl`: 字符导航 
- `n + hjkl`: 向左下上右移动n个行或者字符 
- `0`: 跳转到本行开始  
- `$`: 跳转到本行结尾   
- `^`: 跳转到本行第一个非空字符 `g_`跳转到本行最后一个非空字符串(`$`的使用于`g_`的区别，还是`$`在使用中普遍)  
- `n|`: 跳转到本行第n列 
- `fs`: focusOn string 在本行内光标之后开始搜索，光标停留在字符`s`上 
- `Fs`: focusOn string 在本行内光标之前开始搜索，光标停留在字符`s`上 
- `ts` : focusOn string 在本行内光标之后开始搜索，光标停留在字符`s`之前 
- `Ts` : focusOn string 在本行内光标之前开始搜索，光标停留在字符`s`之前   
  - `;`: 表示继续 在本行向下搜索下一个 
  - `,`: 表示继续 在本行向上搜索上一个

#### 5.2 句子和段落导航 
- 句子定义：指以 `.?!`这三个字符 跟着一个换行符或者空格、tab结尾的，就算一个句子。    
- `(`跳到前一个句子 
- `)`跳到下一个句子 

- 段落：可以从一个空行之后开始，也可以从段落选项中`字符对`所指定的段落宏的每个集合开始。  
- `{`跳到上一个段落
- `}`跳到下一个段落

####  5.3 ⭐️ 行号导航 
- `nG`:跳转到第n行  
- `gg`:跳转到第一行 
- `G`:跳转到最后一行  
- `n%`:跳转到文件的百分比 
- `ctrl + g`:可以看到总行数以及当前所在行数   

#### 5.4 窗格导航 
- `H`:Head 跳转到屏幕的顶部  
- `M`:Middle 跳转到屏幕的中部 
- `L`:Line   跳转到屏幕的底部 
- `nH`:跳转到距离顶部n行的位置  
- `nL`:跳转到距离底部n行的位置  

#### 5.5 ⭐️ 屏幕滚动
普通模式下：
- `ctrl + e`:向下滚动一行-> e,中文一，就是向下一行  
- `ctrl + y`:向上滚动一行-> yu,骑驴的时候让驴听一下，回大喊一声yu，也就是退一步	

- `ctrl + f`:向下滚动一屏-> full screen
- `ctrl + b`:向上滚动一屏-> back screen

- `ctrl + u`:向上滚动半屏->up,up半屏。   
- `ctrl + d`:向下滚动半屏-> down，down半屏

#### 5.6 当前行位置指定
- `zt`:将当前行 指定到窗格的顶部 
- `zz`:将当前行 指定到窗格的中间 
- `zb`:将当前行 指定搭配窗格的底部 

#### 5.7 位置标记(暂了解即可)
- `ma`:标记当前位置 
- ``a`:回到标记的位置(行与列)  
- `'a`:回到标记的行

#### 5.8 跳转
在普通模式下：  
- `nG`:跳转到第n行
- `/`:向后搜索跳转  
- `?`:向前搜索跳转  
- `n` 重复上一次搜索，相同方向
- `N` 重复上一次搜索，相反方向
- `%` 查找匹配
- `(` 跳转上一个句子
- `)` 跳转下一个句子
- `{` 跳转上一个段落
- `}` 跳转下一个段落
- `L` 跳转到当前屏幕的最后一行
- `M` 跳转到当前屏幕的中间
- `H` 跳转到当前屏幕的第一行
- `[[` 跳转到上一个小节
- `]]` 跳转到下一个小节
- `'a`:跳转到标记的行
- ``a`:跳转到标记的行和列 

### 六、输入模式
这一节通过输入模式来提升输入效率。  

#### 6.1 ⭐️ 进入输入模式的方法
- `i`:  从光标位置的前面开始输入内容 
- `I`:  从光标所在行的第一个非空字符开始输入内容
- `a`:  与i是相对应的，从光标位置的后面开始输入内容
- `A`:  与I是相对应的，从当前行的末尾非空文本后追加文本
- `o`:  这个小o是非常的有用，在当前光标位置的下方自己给新起一行开始输入文本
- `O`:  这个是与小o对应，在当前行的上一行开始新加一行并开始输入文本
- `s`:  删除当前光标处字符，并开始输入内容
- `S`:  删除光标所在当前行内容，并开始输入内容
#### 6.2 退出输入模式的方法
除了Esc外，还可以直接使用`Ctrl + c`的方式退出输入模式

#### 6.3 删除模式
输入过程出现错误的合理做法是切换到普通模式，使用d来删除错误

在输入模式中也是可以删除的:
- `Ctrl + h`是删除一个字符
- `ctrl + w`是删除一个单词
- `ctrl + u`是删除一行

#### 6.4 寄存器输入
寄存器是说在a-z这个标识直接对一个单词在普通模式下进行保存操作`"ayiw`，然后在输入模式中使用`ctrl + r a`的方式进行保存  
这里在使用寄存器输入之前先用好`y$` `yw`，结合p、P，再考虑使用寄存器。

#### 6.5 输入模式下的翻页
输入模式下也是可以翻页的	
- `ctrl + x  ctrl + y`: 向上滚动页面 
- `ctrl + x  ctrl + e`: 向下滚动页面
#### 6.6 ⭐️ 执行普通模式下的命令
在输入模式下，可以使用普通模式下的命令。

- 输入模式下，键入`ctrl + o`就进入了普通模式（左下角的模拟指示器显示 --insert--),这个时候就可以使用普通模式下的命令
- `ctrl + o zz` 剧中窗口显示光标所在位置 
- `ctrl + o H/M/L`  光标跳转到窗口的顶部、中部、底部
- `ctrl +o D` 从光标处删除到行尾

### 七、点命令
使用点命令来重放上一个修改动作，点命令是最简单的命令，也是减少重复操作最有用的命令。  
#### 7.1 用法
想把下面的代码中`let`替换成`const`
```
let one = '1'
let two = '2'
let three ='3'
```
1. 使用`/let`进行匹配 
2. 使用`cwconst<esc>` 将匹配到的第一个替换成了 `const`  
3. 使用`n`找到下一个匹配的位置  
4. 使用`.`命令，重复之前的匹配的操作  
5. 持续 `n.n.`将每一个词进行替换 

#### 7.2 怎么算是修改操作
使用普通模式下的命令来更新(添加、修改、删除)当前缓冲区内容时，就是执行一个修改操作。    
```
first, second, third,
```
删除从开始到第一个逗号出现的位置：`df,`使用`.`重复两次直到整个句子删除。  

将下面中的逗号删除，不删除文本
```
liugezhou,is,a,Cool,boy
```
根据`5.1`我们知道`fs`命令是搜索到字符`s`所在的位置，因此这里只删除`,`的操作，我们使用：`f,x;.;.`的方式  
之所以加`;`是因为在vim中，操作是不包括移动的，这里是使用`;`移动到下一个目标点，执行删除操作。 

再看一个例子
```
my 
name
is 
liugezhou
```
目的是要在每一行结尾加上逗号：  
- 首先根据`6.1`我们知道`A`是在当前行结尾追加内容  
- 然后根据vim中的点操作不包括移动，我们这样： 
- `A, <ESC> j .<ESC> j .<ESC> j .`
从按下命令A开始，到退出模式之间的所有输入都算是一整个修改操作。 

#### 7.3 重复多行修改操作
```
1  Hello World!
2 Hello World!
3 Hello World!
4 Hello World!
5 Hello World!
6 Hello World!
7 Hello World!
```
有7行数据，要删除的是除了第5行。我们这里使用简单的删除方法：先删除前四行，再删除第6、7行。    
命令位：`d4jjd2j` 
解析：其中`d`为操作删除，`4j`类比于`5.3节`的`nG`,即要删除的范围为：当前光标处下移动4行。`j`表示下。

点命令非常简单且功能强大，这里先记录这三个。

### 八、寄存器 

#### 8.1 10种寄存器类型
1. 匿名寄存器(`""`)
2. 编号寄存器(`"0-9`)
3. 小删除寄存器(`"-`)
4. 命名寄存器(`"a-z`) 
5. 只读寄存器(`:`,`:.`,`"%`)
6. Buffer交替文件寄存器(`"#`)
7. 表达式寄存器(`"=`) 
8. 选取和拖放寄存器(`"*`,`"+`)
9. 黑洞寄存器(`"_`)
10. 探索模式寄存器(`"/`)

#### 8.2 寄存器命令
从存值和取值两个方面了解哪些命令与寄存器有关。

存值到寄存器中的操作：
- `y`: 复制 
- `c`: 删除并进入插入模式 [需要跟名词]
- `d`: 删除 [需要跟名词]
- `s`: 直接删除光标处字符并进入插入模式 
- `S`: 直接删除光标所在行内容并进入插入模式
- `x`: 直接删除处于光标处字符，与`s`不同为仍然处于普通模式
- `x`: 直接删除处于光标处上一个字符，且仍然处于普通模式

从寄存器中取出文本操作
- `p`:在光标位置之后粘贴文本  
- `P`:在光标位置之前粘贴文本

- `p`和`P`都可以接受计数和一个寄存器标志作为参数。  
- `10p`表示：当前光标之后，将上一次存值到寄存器中的内容，复制100遍。  
- `10"ap`表示：将寄存器`a`中的文本粘贴10次。(关于寄存器`a`如何寄存，8.4内容介绍) 

#### 8.3 在输入模式中使用寄存器
输入模式下使用寄存器的命令为：  
`ctrl + r a`  
这里的`a`是指寄存器的标志(关于标签a如何添加，下面内容介绍)。 

#### 8.4 ⭐️ 不同类型寄存器标志说明  

**1.匿名寄存器""**  
说明：匿名寄存器存储的是最近的一次复制、修改或者删除的文本，和电脑上的粘贴功能一个意思。  
语法：`p` || `P`

**2.编号寄存器(1-9)**
说明：编号寄存器自动以升序进行填充，按0-9分为复制寄存器(0)和其他编号寄存器(1-9) 

复制寄存器(0):是指若是复制操作(`yy`复制一行)，Vim会将文本存放在两个寄存器中->匿名寄存器`p`和复制寄存器`0`中去，这里的操作只能是复制，删除不管用，好处是最新复制的内容一直会在复制寄存器中。   
语法：普通模式下->`"0p`,插入模式下->`ctrl + r 0`

编号寄存器(0-9):当修改或者删除至少一整行的文本时，这部分文本会按时间顺序被存储在1-9号编号寄存器中(编号越小，距离时间越近)。    
语法：普通模式下->`"np`,插入模式下->`ctrl + r n`
注意：小型的单词删除(`dw`OR`vw`)不会被储存在编号寄存器中，会被储存在小删除寄存器中`"-`。

**3.小删除寄存器("-)**