<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="六个周的博客"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="六个周"><meta name="twitter:creator" content="@liugezhou"><meta name="twitter:title" content="Week28-脚手架发布模块架构设计和核心流程开发"><meta name="twitter:description" content="&lt;p&gt;&lt;font color=blue&gt;更新说明：对文章目录排版做了调整。&lt;/font&gt;&lt;br&gt;
&lt;font color=blue&gt; 更新时间：2022-05-04&lt;/font&gt;&lt;/p&gt;
&lt;h2 id=&quot;第一章：周介绍&quot;&gt;第一章：周介绍&lt;/h2&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;掌握脚手架发布模块的整体架构设计和实现原理&lt;/li&gt;
&lt;li&gt;掌握前端发布流程，并了解history和hash两种路由模式的区别&lt;/li&gt;
&lt;li&gt;深入理解vue-router原理&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;关键词&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;前端发布&lt;/li&gt;
&lt;li&gt;前端路由&lt;/li&gt;
&lt;li&gt;vue-router&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;第二章：脚手架发布流程架构设计&quot;&gt;第二章：脚手架发布流程架构设计&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;2-1  脚手架发布功能和流程讲解&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;不依靠后端或服务端人员，使用脚手架快速对更改的内容进行项目发布。&lt;/li&gt;
&lt;li&gt;imooc-cli --packagePath /Users/liumingzhou/Desktop/imooc-cli/packages/publish
&lt;ul&gt;
&lt;li&gt;git配置检查：保证远程仓库存在&lt;/li&gt;
&lt;li&gt;git自动提交(输入commit信息)：避免本地代码提交的繁杂操作&lt;/li&gt;
&lt;li&gt;云构建+云发布：检查build结果、按照依赖、云构建、云发布、云断开&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://www.processon.com/embed/60f240e1e401fd4fe0531bef&quot;&gt;点击查看【processon】&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2-2 绘制项目发布架构设计图&lt;/strong&gt;&lt;br&gt;
&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-1.7b7b0edh7fs0.webp&quot; alt=&quot;28-1&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;第三章：imooc-cli脚手架git-flow-自动化架构设计&quot;&gt;第三章：imooc-cli脚手架git flow 自动化架构设计&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;3-1 git flow 基础流程讲解&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;git flow是2010年 Vincent Driessen设计出来的。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://www.processon.com/embed/60f2487c1efad41bbea86894&quot;&gt;点击查看【processon】&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3-2 git flow 多人协作流程讲解（详细讲解大厂git flow流程)&lt;/strong&gt;&lt;br&gt;
&lt;a href=&quot;https://www.processon.com/embed/60f250be0e3e7453927475af&quot;&gt;点击查看【processon】&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3-3 脚手架git flow prepare阶段架构设计&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ProcessOn画图&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;3-4 脚手架git flow 执行阶段架构设计 -Init&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ProcessOn画图&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;第四章-imooc-cli-脚手架云构建-云发布架构设计&quot;&gt;第四章 imooc-cli 脚手架云构建 + 云发布架构设计&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;4-1 云构建+云发布整体流程设计&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;4-2 云构建+云发布详细流程设计1&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;4-3 云构建+云发布详细流程设计2&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;4-4 深入讲解云发布原理&lt;/strong&gt;&lt;br&gt;
&lt;a href=&quot;https://www.processon.com/embed/60f258a11e085376da5a1525&quot;&gt;点击查看【processon】&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;第五章：imooc-cli脚手架publish模块开发&quot;&gt;第五章：imooc-cli脚手架publish模块开发&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;5-1 创建publish模块&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本模块在调试的时候出现问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;lerna create @cloudscope-cli/publish commands&lt;/li&gt;
&lt;li&gt;publish模块下lib的index中，打印日志：console.log(‘publish’)&lt;/li&gt;
&lt;li&gt;接着使用webstorm调试exec的时候，debug没有进去。&lt;/li&gt;
&lt;li&gt;参数为：
&lt;ul&gt;
&lt;li&gt;Node parameters:&lt;strong&gt;/Users/liumingzhou/Documents/imoocCourse/Web前端架构师/cloudscope-cli/core/cli/bin/index.js  publish  --targetPath /Users/liumingzhou/Documents/imoocCourse/Web前端架构师/cloudscope-cli/commands/publish&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Working directory: &lt;strong&gt;~/Desktop/test&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;查找原因为：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;首先将本地连接全部去除 ： 进入到node的modules目录下将相关的脚手架liugezhou的cloudscope的全部删除&lt;/li&gt;
&lt;li&gt;进入到cloudscope-cli/core/cli 下npm install
&lt;ul&gt;
&lt;li&gt;发现在utils下等有一些package2的包，于是去到相关包下，删除重新安装&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;npm install正确后，npm link，link完毕之后在本地which cloudscole-cli 看到有了包&lt;/li&gt;
&lt;li&gt;然后在webstorm中调试的  Node parameters中重新配置(在publish之前加空格)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;最后在一个空目录中输入以下命令进行调试：&lt;br&gt;
cloudscope-cli publish --targetPath /Users/liumingzhou/Documents/imoocCourse/Web前端架构师/cloudscope-cli/commands/publish&lt;br&gt;
打印出：publish&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;5-2 publish基本流程开发&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;接下来的重点就是编写业务代码：cloudscope-cli/commands/publish/lib/index.js&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;参考init中的代码，extends Command&lt;/li&gt;
&lt;li&gt;必须实现init和exec方法，否则报错&lt;/li&gt;
&lt;li&gt;该文件中用到的log / Command等需要npm install引入&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;#x27;use strict&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Command&lt;/span&gt; = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;@cloudscope-cli/command&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; log = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;@cloudscope-cli/log&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;PublishCommand&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title class_ inherited__&quot;&gt;Command&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title function_&quot;&gt;init&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 处理参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;init&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;variable language_&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;_argv&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;exec&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; startTime = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Date&lt;/span&gt;().&lt;span class=&quot;title function_&quot;&gt;getTime&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//1. 初始化检查&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;variable language_&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;prepare&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//2.Git Flow自动化&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//3.云构建 + 云发布&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; endTime = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Date&lt;/span&gt;().&lt;span class=&quot;title function_&quot;&gt;getTime&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            log.&lt;span class=&quot;title function_&quot;&gt;info&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;本次发布耗时&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;title class_&quot;&gt;Math&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;floor&lt;/span&gt;(endTime-startTime)/&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;+&lt;span class=&quot;string&quot;&gt;&amp;#x27;秒&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            log.&lt;span class=&quot;title function_&quot;&gt;error&lt;/span&gt;(e.&lt;span class=&quot;property&quot;&gt;message&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(process.&lt;span class=&quot;property&quot;&gt;env&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;LOG_LEVEL&lt;/span&gt; === &lt;span class=&quot;string&quot;&gt;&amp;#x27;verbose&amp;#x27;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                log.&lt;span class=&quot;title function_&quot;&gt;error&lt;/span&gt;(e.&lt;span class=&quot;property&quot;&gt;message&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;title function_&quot;&gt;prepare&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	 &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;init&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;argv&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;PublishCommand&lt;/span&gt;(argv)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable language_&quot;&gt;module&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;exports&lt;/span&gt; = init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable language_&quot;&gt;module&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;exports&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;PublishCommand&lt;/span&gt; = &lt;span class=&quot;title class_&quot;&gt;PublishCommand&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;5-3 项目发布前预检查流程开发&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;结合上一节代码，本节主要内容为：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;初始化检查prepare
&lt;ul&gt;
&lt;li&gt;确认项目是否npm项目&lt;/li&gt;
&lt;li&gt;确认项目的package.json中是否包含name/version/scripts/scripts.build&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;title function_&quot;&gt;prepare&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 1.确认项目是否为npm项目&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; projectPath =  process.&lt;span class=&quot;title function_&quot;&gt;cwd&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; pkgPath = path.&lt;span class=&quot;title function_&quot;&gt;resolve&lt;/span&gt;(projectPath,&lt;span class=&quot;string&quot;&gt;&amp;#x27;package.json&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  log.&lt;span class=&quot;title function_&quot;&gt;verbose&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;package.json&amp;#x27;&lt;/span&gt;,pkgPath)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!fs.&lt;span class=&quot;title function_&quot;&gt;existsSync&lt;/span&gt;(pkgPath))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Error&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;package.json不存在&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//2. 确认是否包含name\version\build命令&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; pkg = fse.&lt;span class=&quot;title function_&quot;&gt;readJsonSync&lt;/span&gt;(pkgPath)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &amp;#123;name,version,scripts&amp;#125; = pkg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!name || !version || !scripts || !scripts.&lt;span class=&quot;property&quot;&gt;build&lt;/span&gt; )&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Error&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;package.json信息不全，请检查是否存在name、version和scripts(需提供build命令)&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;variable language_&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;projectInfo&lt;/span&gt; = &amp;#123;name,version,&lt;span class=&quot;attr&quot;&gt;dir&lt;/span&gt;:projectPath&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;第六章-本周加餐：前端路由模式原理和-vue-router-源码讲解&quot;&gt;第六章 本周加餐：前端路由模式原理和 vue-router 源码讲解&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;本章内容测试代码上传至：&lt;/strong&gt;&lt;a href=&quot;https://github.com/liugezhou/vue-router-demo&quot;&gt;https://github.com/liugezhou/vue-router-demo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6-1 vue-router-next完整运行流程解析&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;vue-router-next源码解析&lt;/strong&gt;&lt;br&gt;
vue-router常见问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;history和hash模式的区别是什么（涉及vue-router路由模式和前端发布原理）&lt;/li&gt;
&lt;li&gt;Vue dev模式下为什么不需要配置history fallback(涉及webpack-dev-server配置)&lt;/li&gt;
&lt;li&gt;我们没有定义router-link和router-view，为什么代码里能直接使用(涉及vue-router初始化流程和Vue插件)&lt;/li&gt;
&lt;li&gt;浏览器如何实现URL变化但页面不刷新(涉及vue-router history模式核心实现原理)&lt;/li&gt;
&lt;li&gt;vue-router如何实现路由匹配(涉及 vue-router Matcher 实现原理)&lt;/li&gt;
&lt;li&gt;router-view如何实现组件动态渲染？(涉及Vue动态组件)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;通过imooc-cli脚手架安装一个vue3标准模版&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;npm install -g @imooc-cli/core&lt;/li&gt;
&lt;li&gt;imooc-cli init test&lt;/li&gt;
&lt;li&gt;npm install -S vue-router（package.json中安装的版本为3.5.2，我们需要手动改成4.0.0-0,然后安装）&lt;/li&gt;
&lt;li&gt;新建三个组件  src/pages/Home.vue | src/pages/Order.vue | src/pages/My.vue&lt;/li&gt;
&lt;li&gt;新建src/router.js&lt;/li&gt;
&lt;li&gt;并在main.js中引入，app.use(router)&lt;/li&gt;
&lt;li&gt;在App.vue中使用&lt;router-link/&gt;和&lt;router-view/&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// src/router.js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &amp;#123;createWebHistory,createRouter&amp;#125; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;vue-router&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Home&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;./pages/Home&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;My&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;./pages/My&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Order&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;./pages/Order&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; routes = [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;path&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;/&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;root&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;redirect&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;/home&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;,&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;path&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;/home&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;home&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;component&lt;/span&gt;:&lt;span class=&quot;title class_&quot;&gt;Home&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;,&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;path&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;/my&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;my&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;component&lt;/span&gt;:&lt;span class=&quot;title class_&quot;&gt;My&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;,&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;path&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;/order&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;order&amp;#x27;&lt;/span&gt;,&lt;span class=&quot;attr&quot;&gt;component&lt;/span&gt;:&lt;span class=&quot;title class_&quot;&gt;Order&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; routerHitory = &lt;span class=&quot;title function_&quot;&gt;createWebHistory&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; router = &lt;span class=&quot;title function_&quot;&gt;createRouter&lt;/span&gt;(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;attr&quot;&gt;history&lt;/span&gt;:routerHitory,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  routes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; router;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// App.vue&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;template&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;vue3&amp;quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;vue3 template&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;div&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;router-link&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;to&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;#x27;/home&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;Home | &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;router-link&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;router-link&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;to&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;#x27;/order&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;Order | &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;router-link&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;router-link&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;to&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;#x27;/my&amp;#x27;&lt;/span&gt;&amp;gt;&lt;/span&gt;My | &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;router-link&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;router-view&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;template&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;language-javascript&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;Vue3&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;language-css&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-css&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&lt;span class=&quot;selector-id&quot;&gt;#vue3&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-css&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;  &lt;span class=&quot;attribute&quot;&gt;width&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;100%&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-css&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;  &lt;span class=&quot;attribute&quot;&gt;height&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;100%&lt;/span&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-css&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;language-css&quot;&gt;&lt;span class=&quot;language-xml&quot;&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;6-2 vue-router路由模式+history路由部署详细教学&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Vue-router路由模式&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;hash：createWebHashHistory()&lt;/li&gt;
&lt;li&gt;history：createWebHistory()&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;hash和history模式的区别&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;语法结构不同 ：hash添加#意味着一个辅助说明，#后面参数发送改变后并不会加载资源，history模式只要路径改变就会重新请求资源，但是如果页面刷新的话 hash和history都是会重新加载资源的。&lt;/li&gt;
&lt;li&gt;部署方式不同(history部署)
&lt;ul&gt;
&lt;li&gt;npm run build&lt;/li&gt;
&lt;li&gt;nginx 静态网站服务器配置文件如下&lt;/li&gt;
&lt;li&gt;localhost:8081访问后，换不同的路由，页面刷新会显示404&lt;/li&gt;
&lt;li&gt;此时根据Vue文档，Fallback，在nginx配置文件需要加入如下一行代码&lt;/li&gt;
&lt;li&gt;try_files: $uri  $uri/ /index.html;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       listen       &lt;span class=&quot;number&quot;&gt;8081&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       server_name resource;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       root /&lt;span class=&quot;title class_&quot;&gt;Users&lt;/span&gt;/liumingzhou/&lt;span class=&quot;variable constant_&quot;&gt;XXXXX&lt;/span&gt;/dist;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       autoindex on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;comment&quot;&gt;//跨域设置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          add_header  &lt;span class=&quot;title class_&quot;&gt;Access&lt;/span&gt;-&lt;span class=&quot;title class_&quot;&gt;Control&lt;/span&gt;-&lt;span class=&quot;title class_&quot;&gt;Allow&lt;/span&gt;-&lt;span class=&quot;title class_&quot;&gt;Origin&lt;/span&gt; *;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;try_files&lt;/span&gt;: $uri  $uri/ /index.&lt;span class=&quot;property&quot;&gt;html&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			  &lt;span class=&quot;comment&quot;&gt;// 缓存设置&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       add_header   &lt;span class=&quot;title class_&quot;&gt;Cache&lt;/span&gt;-&lt;span class=&quot;title class_&quot;&gt;Control&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;no-cache, must-revalidate&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;SEO：hash不友好,实际开发应用为history模式。&lt;/li&gt;
&lt;li&gt;history模式跳转，利用的是浏览器对象中的history.pushState/replaceState/back/go/forward&lt;/li&gt;
&lt;li&gt;hash模式跳转，利用的是浏览器对象中的location.href&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;6-3 vue-cli源码调试+dev模式history fallback原理讲解&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;为什么Vue的dev模式下不需要配置history fallback？&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;说明：我们在dev模式下启动项目：npm run serve,在scripts中serve，实际执行的命令是  vue-cli-service serve,这个时候我们调试源码就在&lt;strong&gt;node_modules/.bin/vue-cli-service&lt;/strong&gt;。如果执行全局 vue create，调试该命令的话我们就需要去本地全局安装的vue源码中去调试。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;这个&lt;strong&gt;node_modules/.bin/vue-cli-service&lt;/strong&gt;其实是link文件，我们通过 &lt;strong&gt;ll node_modules/.bin/vue-cli-service&lt;/strong&gt; 就可以看出来。=》…/@vue/cli-service/bin/vue-cli-service.js&lt;/li&gt;
&lt;li&gt;在webstorm中新建Node.js调试，Node parameters为：./node_modules/@vue/cli-service/bin/vue-cli-service.js serve&lt;/li&gt;
&lt;li&gt;然后在上面的文件中打断点，开始进入debug调试模式。&lt;/li&gt;
&lt;li&gt;跟着视频课程的调试，核心代码就是webpack的genHistoryApiFallbackRewrites 与try_files一样的作用&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;6-4 vue-router初始化过程源码分析&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;我们并没有定义router-link和router-view，为什么代码里能直接使用？&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;在vscode的router.js中添加debugger调试，没起作用，因此，该源码的调试是在webstorm中debug的。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-2.20o3twc8o868.webp&quot; alt=&quot;28-2&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;项目启动之后，打开浏览器，点击刷新，会进入到调试处&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-3.5q03uo6szog.webp&quot; alt=&quot;28-3&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;首先进入到&lt;strong&gt;createWebHistory&lt;/strong&gt;方法中去(上图第21行代码)，返回的routerHistory提供了一系列的工具方法(路由跳转、监听的事件方法等)，具体实现源码以及注释如下：&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;createWebHistory&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;base&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 传入的base进行处理&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    base = &lt;span class=&quot;title function_&quot;&gt;normalizeBase&lt;/span&gt;(base);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//historyNavigation提供了一些方法：location/push/replace/state&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 该方法的实现浏览器URL变化但页面不刷新（push），核心是使用了浏览器对象模型history.pushState()和history.replaceState()方法。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; historyNavigation = &lt;span class=&quot;title function_&quot;&gt;useHistoryStateNavigation&lt;/span&gt;(base);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//生成一个listener：destory和listen方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; historyListeners = &lt;span class=&quot;title function_&quot;&gt;useHistoryListeners&lt;/span&gt;(base, historyNavigation.&lt;span class=&quot;property&quot;&gt;state&lt;/span&gt;, historyNavigation.&lt;span class=&quot;property&quot;&gt;location&lt;/span&gt;, historyNavigation.&lt;span class=&quot;property&quot;&gt;replace&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;go&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;delta, triggerListeners = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!triggerListeners)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            historyListeners.&lt;span class=&quot;title function_&quot;&gt;pauseListeners&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        history.&lt;span class=&quot;title function_&quot;&gt;go&lt;/span&gt;(delta);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//将上面的事件拼装到一起，生成一个routerHistory对象返回&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; routerHistory = &lt;span class=&quot;title function_&quot;&gt;assign&lt;/span&gt;(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// it&amp;#x27;s overridden right after&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;location&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        base,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        go,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;createHref&lt;/span&gt;: createHref.&lt;span class=&quot;title function_&quot;&gt;bind&lt;/span&gt;(&lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;, base),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;, historyNavigation, historyListeners);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;defineProperty&lt;/span&gt;(routerHistory, &lt;span class=&quot;string&quot;&gt;&amp;#x27;location&amp;#x27;&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;enumerable&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;get&lt;/span&gt;: &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; historyNavigation.&lt;span class=&quot;property&quot;&gt;location&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;defineProperty&lt;/span&gt;(routerHistory, &lt;span class=&quot;string&quot;&gt;&amp;#x27;state&amp;#x27;&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;enumerable&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;get&lt;/span&gt;: &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; historyNavigation.&lt;span class=&quot;property&quot;&gt;state&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; routerHistory;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;返回routerHistory对象后，接着进入到&lt;strong&gt;createRouter&lt;/strong&gt;方法中，源码以及注释如下：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 从调用createRouter处，options中传入的参数为：history和routes&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;createRouter&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;options&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 第一步生成matcher，matcher的作用是实现路由匹配&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// createRouterMatcher会为每一个简单或复杂的路由生成一个正则表达式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; matcher = &lt;span class=&quot;title function_&quot;&gt;createRouterMatcher&lt;/span&gt;(options.&lt;span class=&quot;property&quot;&gt;routes&lt;/span&gt;, options);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; parseQuery$1 = options.&lt;span class=&quot;property&quot;&gt;parseQuery&lt;/span&gt; || parseQuery;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; stringifyQuery$1 = options.&lt;span class=&quot;property&quot;&gt;stringifyQuery&lt;/span&gt; || stringifyQuery;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 拿到history对象，是createWebHistory或者为createWebHashHistory&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; routerHistory = options.&lt;span class=&quot;property&quot;&gt;history&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((process.&lt;span class=&quot;property&quot;&gt;env&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;NODE_ENV&lt;/span&gt; !== &lt;span class=&quot;string&quot;&gt;&amp;#x27;production&amp;#x27;&lt;/span&gt;) &amp;amp;&amp;amp; !routerHistory)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Error&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;Provide the &amp;quot;history&amp;quot; option when calling &amp;quot;createRouter()&amp;quot;:&amp;#x27;&lt;/span&gt; +&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;string&quot;&gt;&amp;#x27; https://next.router.vuejs.org/api/#history.&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//一些路由守卫的初始化、useCallbacks方法返回一个闭包。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;//每一个路由守卫都对应了一个闭包(代码就不贴了，主要返回了三个方法：add,list,reset,主要作用是缓存路由守卫)。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; beforeGuards = &lt;span class=&quot;title function_&quot;&gt;useCallbacks&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; beforeResolveGuards = &lt;span class=&quot;title function_&quot;&gt;useCallbacks&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; afterGuards = &lt;span class=&quot;title function_&quot;&gt;useCallbacks&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 生成默认router&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; currentRoute = &lt;span class=&quot;title function_&quot;&gt;shallowRef&lt;/span&gt;(&lt;span class=&quot;variable constant_&quot;&gt;START_LOCATION_NORMALIZED&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;………………&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  一些初始化操作&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;………………&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 这里的router即为最终的router对象，包含一系列的属性和方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; router = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        currentRoute,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        addRoute,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        removeRoute,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        hasRoute,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        getRoutes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        resolve,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        options,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        push,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        replace,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        go,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;back&lt;/span&gt;: &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;go&lt;/span&gt;(-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;forward&lt;/span&gt;: &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;go&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;beforeEach&lt;/span&gt;: beforeGuards.&lt;span class=&quot;property&quot;&gt;add&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;beforeResolve&lt;/span&gt;: beforeResolveGuards.&lt;span class=&quot;property&quot;&gt;add&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;afterEach&lt;/span&gt;: afterGuards.&lt;span class=&quot;property&quot;&gt;add&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;onError&lt;/span&gt;: errorHandlers.&lt;span class=&quot;property&quot;&gt;add&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        isReady,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//此处的install方法是在执行app.user(router)的时候会执行到这里(即当这个router被返回到main.js后，下一步就会执行app.user(router),然后就会进入到这方法中去)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;title function_&quot;&gt;install&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;app&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; router = &lt;span class=&quot;variable language_&quot;&gt;this&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;//在此处注册了组件RouterLink和RouterView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.&lt;span class=&quot;title function_&quot;&gt;component&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;RouterLink&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;title class_&quot;&gt;RouterLink&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.&lt;span class=&quot;title function_&quot;&gt;component&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;RouterView&amp;#x27;&lt;/span&gt;, &lt;span class=&quot;title class_&quot;&gt;RouterView&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;//全局主注册了$router $route&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.&lt;span class=&quot;property&quot;&gt;config&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;globalProperties&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;$router&lt;/span&gt; = router;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;defineProperty&lt;/span&gt;(app.&lt;span class=&quot;property&quot;&gt;config&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;globalProperties&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;$route&amp;#x27;&lt;/span&gt;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;enumerable&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;get&lt;/span&gt;: &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;unref&lt;/span&gt;(currentRoute),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isBrowser &amp;amp;&amp;amp;!started &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                currentRoute.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt; === &lt;span class=&quot;variable constant_&quot;&gt;START_LOCATION_NORMALIZED&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                started = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;comment&quot;&gt;//浏览器中push后，就会进行页面的渲染&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;title function_&quot;&gt;push&lt;/span&gt;(routerHistory.&lt;span class=&quot;property&quot;&gt;location&lt;/span&gt;).&lt;span class=&quot;title function_&quot;&gt;catch&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;err&lt;/span&gt; =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((process.&lt;span class=&quot;property&quot;&gt;env&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;NODE_ENV&lt;/span&gt; !== &lt;span class=&quot;string&quot;&gt;&amp;#x27;production&amp;#x27;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;title function_&quot;&gt;warn&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;Unexpected error when starting the router:&amp;#x27;&lt;/span&gt;, err);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; reactiveRoute = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; key &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;variable constant_&quot;&gt;START_LOCATION_NORMALIZED&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                reactiveRoute[key] = &lt;span class=&quot;title function_&quot;&gt;computed&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; currentRoute.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;[key]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;// 使用app.provide来做组件的传递&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;// router-view和router-link中的参数是通过这里传递下去的&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;// 关于provide的用法，见本节内容往下&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.&lt;span class=&quot;title function_&quot;&gt;provide&lt;/span&gt;(routerKey, router);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.&lt;span class=&quot;title function_&quot;&gt;provide&lt;/span&gt;(routeLocationKey, &lt;span class=&quot;title function_&quot;&gt;reactive&lt;/span&gt;(reactiveRoute));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.&lt;span class=&quot;title function_&quot;&gt;provide&lt;/span&gt;(routerViewLocationKey, currentRoute);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; unmountApp = app.&lt;span class=&quot;property&quot;&gt;unmount&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            installedApps.&lt;span class=&quot;title function_&quot;&gt;add&lt;/span&gt;(app);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            app.&lt;span class=&quot;property&quot;&gt;unmount&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                installedApps.&lt;span class=&quot;title function_&quot;&gt;delete&lt;/span&gt;(app);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (installedApps.&lt;span class=&quot;property&quot;&gt;size&lt;/span&gt; &amp;lt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;title function_&quot;&gt;removeHistoryListener&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    currentRoute.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt; = &lt;span class=&quot;variable constant_&quot;&gt;START_LOCATION_NORMALIZED&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    started = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ready = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;title function_&quot;&gt;unmountApp&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; router;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;6-5 vue3高级特性：vue插件+provide跨组件通信&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;浏览器中如何实现URL变化但页面不刷新&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;在控制台直接输入  history.pushState(null,null,‘/Order’/),会发现浏览器窗口中地址发生了改变，但页面未刷新。&lt;/li&gt;
&lt;li&gt;onpopState事件主要用来监听路由回退的操作。&lt;/li&gt;
&lt;li&gt;调试源码的步骤是，写一个click方法，点击debuger进行操作&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;button @click=&lt;span class=&quot;string&quot;&gt;&amp;quot;jump&amp;quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;title class_&quot;&gt;Jump&lt;/span&gt;&amp;lt;/button&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;………………&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &amp;#123; useRouter &amp;#125; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;vue-router&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;App&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;title function_&quot;&gt;setup&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; router = &lt;span class=&quot;title function_&quot;&gt;useRouter&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;title function_&quot;&gt;jump&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// eslint-disable-next-line no-debugger&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;debugger&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        router.&lt;span class=&quot;title function_&quot;&gt;push&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;/order&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;然后step into到router.push方法中，由此开始调试，进入pushWithRedirect()方法中(如下图)&lt;br&gt;
&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-4.4fsku45pmnw0.webp&quot; alt=&quot;28-4&quot;&gt;&lt;br&gt;
然后一步一步的，调试源码到最后，最终会通过history.pushState()方法，来改变地址而不发生页面的更新。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在上图的高亮部分resolve(to)是路由匹配的相关实现，下节继续。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6-7 vue-router路由匹配源码分析&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我们输入路由后如何与我们自己定义的 routes中的路由进行匹配，就涉及到vue-router的核心概念 matcher。&lt;br&gt;
两个关键点是：createRouter以及上一节提到的resollve方法。&lt;br&gt;
&lt;img src=&quot;https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-5.6g8w1s5ubqc0.webp&quot; alt=&quot;28-5&quot;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;本节重点讲解这个resolve方法，我们假定从 /home跳转到/order，代码以及注释如下：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;resolve&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;rawLocation, currentLocation&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 第一步是拿到currentLocation，即当前路由相关信息 【/home相关的】&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        currentLocation = &lt;span class=&quot;title function_&quot;&gt;assign&lt;/span&gt;(&amp;#123;&amp;#125;, currentLocation || currentRoute.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// 判断传进来的路由‘/order’参数是不是string&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; rawLocation === &lt;span class=&quot;string&quot;&gt;&amp;#x27;string&amp;#x27;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;//进行一个形式的格式化吧&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; locationNormalized = &lt;span class=&quot;title function_&quot;&gt;parseURL&lt;/span&gt;(parseQuery$1, rawLocation, currentLocation.&lt;span class=&quot;property&quot;&gt;path&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;//最关键的一步是调用matcher下的resolve方法，传入两个参数 ‘/order’和‘/home’，到这里我们需要继续step into到这个方法中去调试。关键代码为： matchers.find(m =&amp;gt; m.re.test(path)); &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; matchedRoute = matcher.&lt;span class=&quot;title function_&quot;&gt;resolve&lt;/span&gt;(&amp;#123; &lt;span class=&quot;attr&quot;&gt;path&lt;/span&gt;: locationNormalized.&lt;span class=&quot;property&quot;&gt;path&lt;/span&gt; &amp;#125;, currentLocation);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; href = routerHistory.&lt;span class=&quot;title function_&quot;&gt;createHref&lt;/span&gt;(locationNormalized.&lt;span class=&quot;property&quot;&gt;fullPath&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((process.&lt;span class=&quot;property&quot;&gt;env&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;NODE_ENV&lt;/span&gt; !== &lt;span class=&quot;string&quot;&gt;&amp;#x27;production&amp;#x27;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (href.&lt;span class=&quot;title function_&quot;&gt;startsWith&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;//&amp;#x27;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;title function_&quot;&gt;warn&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;`Location &amp;quot;&lt;span class=&quot;subst&quot;&gt;$&amp;#123;rawLocation&amp;#125;&lt;/span&gt;&amp;quot; resolved to &amp;quot;&lt;span class=&quot;subst&quot;&gt;$&amp;#123;href&amp;#125;&lt;/span&gt;&amp;quot;. A resolved location cannot start with multiple slashes.`&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!matchedRoute.&lt;span class=&quot;property&quot;&gt;matched&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;length&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;title function_&quot;&gt;warn&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;`No match found for location with path &amp;quot;&lt;span class=&quot;subst&quot;&gt;$&amp;#123;rawLocation&amp;#125;&lt;/span&gt;&amp;quot;`&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// locationNormalized is always a new object&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;assign&lt;/span&gt;(locationNormalized, matchedRoute, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;params&lt;/span&gt;: &lt;span class=&quot;title function_&quot;&gt;decodeParams&lt;/span&gt;(matchedRoute.&lt;span class=&quot;property&quot;&gt;params&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;hash&lt;/span&gt;: &lt;span class=&quot;title function_&quot;&gt;decode&lt;/span&gt;(locationNormalized.&lt;span class=&quot;property&quot;&gt;hash&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;redirectedFrom&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;undefined&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                href,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        …………………………………………&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;6-8 vue3新特性defineComponent讲解1 &amp;amp;&amp;amp; 6-9 vue3新特性defineComponent讲解2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;router-view如何实现组件动态渲染(涉及Vue动态组件)&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;本节从router对象的install方法开始，找到 app.component(‘RouterView’,RouterView)。&lt;/li&gt;
&lt;li&gt;2328行定义：const RouterView = RouterViewImpl;&lt;/li&gt;
&lt;li&gt;RouterView就是RouterViewImpl方法，该方法源码如下&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;通过** 6-10 &lt;strong&gt;章节所示源码，我们看到router-view组件是以纯js实现的方式，使用&lt;/strong&gt;defineComponent&lt;strong&gt;定义组件，组件的渲染使用了&lt;/strong&gt;h**函数。&lt;/li&gt;
&lt;li&gt;在进一步看源码之前，我们先来写个demo看  如何使用纯js方式编写组件。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;h 函数包含的三个参数为：dom标签、dom中需要绑定的一些属性、dom当中的children。&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;下面为代码演示，注释部分为直接使用Home组件的渲染。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &amp;#123; defineComponent,h &amp;#125; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;vue&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// import  Home from &amp;#x27;../pages/Home&amp;#x27;;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;TestComponent2&lt;/span&gt; = &lt;span class=&quot;title function_&quot;&gt;defineComponent&lt;/span&gt;(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;TestComponent2&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;props&lt;/span&gt;:&amp;#123;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title function_&quot;&gt;setup&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;props, &amp;#123;slots&amp;#125; &lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;()=&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;h&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;div&amp;#x27;&lt;/span&gt;,&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&amp;#x27;test-component2&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;title function_&quot;&gt;onClick&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;title function_&quot;&gt;alert&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;click&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;,slots.&lt;span class=&quot;title function_&quot;&gt;default&lt;/span&gt;())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// return () =&amp;gt;&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//     return h(Home,&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//         onClick()&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//             alert(&amp;#x27;You Clicked the Home Component!&amp;#x27;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//         &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//     &amp;#125;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// &amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;TestComponent2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;6-10 深入解析router-view源码&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;RouterViewImpl&lt;/span&gt; = &lt;span class=&quot;comment&quot;&gt;/*#__PURE__*/&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;defineComponent&lt;/span&gt;(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;RouterView&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;inheritAttrs&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;props&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;title class_&quot;&gt;String&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;default&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;default&amp;#x27;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;route&lt;/span&gt;: &lt;span class=&quot;title class_&quot;&gt;Object&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// setup在整个组件初始化的时候只会执行一遍，但下面的render function，也就是40行的return部分会执行多次&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;title function_&quot;&gt;setup&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;props, &amp;#123; attrs, slots &amp;#125;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        (process.&lt;span class=&quot;property&quot;&gt;env&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;NODE_ENV&lt;/span&gt; !== &lt;span class=&quot;string&quot;&gt;&amp;#x27;production&amp;#x27;&lt;/span&gt;) &amp;amp;&amp;amp; &lt;span class=&quot;title function_&quot;&gt;warnDeprecatedUsage&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// injectedRoute决定router-view的刷新&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; injectedRoute = &lt;span class=&quot;title function_&quot;&gt;inject&lt;/span&gt;(routerViewLocationKey);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// injectedRoute.value&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; routeToDisplay = &lt;span class=&quot;title function_&quot;&gt;computed&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; props.&lt;span class=&quot;property&quot;&gt;route&lt;/span&gt; || injectedRoute.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; depth = &lt;span class=&quot;title function_&quot;&gt;inject&lt;/span&gt;(viewDepthKey, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; matchedRouteRef = &lt;span class=&quot;title function_&quot;&gt;computed&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; routeToDisplay.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;matched&lt;/span&gt;[depth]);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;title function_&quot;&gt;provide&lt;/span&gt;(viewDepthKey, depth + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;title function_&quot;&gt;provide&lt;/span&gt;(matchedRouteKey, matchedRouteRef);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;title function_&quot;&gt;provide&lt;/span&gt;(routerViewLocationKey, routeToDisplay);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// 空的ref用来装载马上要渲染的view-router实例&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; viewRef = &lt;span class=&quot;title function_&quot;&gt;ref&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;title function_&quot;&gt;watch&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; [viewRef.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;, matchedRouteRef.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;, props.&lt;span class=&quot;property&quot;&gt;name&lt;/span&gt;], &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;[instance, to, name], [oldInstance, &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt;, oldName]&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (to) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                to.&lt;span class=&quot;property&quot;&gt;instances&lt;/span&gt;[name] = instance;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; !== to &amp;amp;&amp;amp; instance &amp;amp;&amp;amp; instance === oldInstance) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!to.&lt;span class=&quot;property&quot;&gt;leaveGuards&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;size&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        to.&lt;span class=&quot;property&quot;&gt;leaveGuards&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;leaveGuards&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!to.&lt;span class=&quot;property&quot;&gt;updateGuards&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;size&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        to.&lt;span class=&quot;property&quot;&gt;updateGuards&lt;/span&gt; = &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;updateGuards&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (instance &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                to &amp;amp;&amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                (!&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; || !&lt;span class=&quot;title function_&quot;&gt;isSameRouteRecord&lt;/span&gt;(to, &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt;) || !oldInstance)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                (to.&lt;span class=&quot;property&quot;&gt;enterCallbacks&lt;/span&gt;[name] || []).&lt;span class=&quot;title function_&quot;&gt;forEach&lt;/span&gt;(&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;params&quot;&gt;callback&lt;/span&gt; =&amp;gt;&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;callback&lt;/span&gt;(instance));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;comment&quot;&gt;// 默认为pre属性，post在页面渲染之后执行 watch 监听&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;, &amp;#123; &lt;span class=&quot;attr&quot;&gt;flush&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;#x27;post&amp;#x27;&lt;/span&gt; &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; route = routeToDisplay.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; matchedRoute = matchedRouteRef.&lt;span class=&quot;property&quot;&gt;value&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;ViewComponent&lt;/span&gt; = matchedRoute &amp;amp;&amp;amp; matchedRoute.&lt;span class=&quot;property&quot;&gt;components&lt;/span&gt;[props.&lt;span class=&quot;property&quot;&gt;name&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; currentName = props.&lt;span class=&quot;property&quot;&gt;name&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;title class_&quot;&gt;ViewComponent&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;normalizeSlot&lt;/span&gt;(slots.&lt;span class=&quot;property&quot;&gt;default&lt;/span&gt;, &amp;#123; &lt;span class=&quot;title class_&quot;&gt;Component&lt;/span&gt;: &lt;span class=&quot;title class_&quot;&gt;ViewComponent&lt;/span&gt;, route &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; routePropsOption = matchedRoute.&lt;span class=&quot;property&quot;&gt;props&lt;/span&gt;[props.&lt;span class=&quot;property&quot;&gt;name&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; routeProps = routePropsOption&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ? routePropsOption === &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ? route.&lt;span class=&quot;property&quot;&gt;params&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    : &lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; routePropsOption === &lt;span class=&quot;string&quot;&gt;&amp;#x27;function&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        ? &lt;span class=&quot;title function_&quot;&gt;routePropsOption&lt;/span&gt;(route)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        : routePropsOption&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                : &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;onVnodeUnmounted&lt;/span&gt; = vnode =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// remove the instance reference to prevent leak&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (vnode.&lt;span class=&quot;property&quot;&gt;component&lt;/span&gt;.&lt;span class=&quot;property&quot;&gt;isUnmounted&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    matchedRoute.&lt;span class=&quot;property&quot;&gt;instances&lt;/span&gt;[currentName] = &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; component = &lt;span class=&quot;title function_&quot;&gt;h&lt;/span&gt;(&lt;span class=&quot;title class_&quot;&gt;ViewComponent&lt;/span&gt;, &lt;span class=&quot;title function_&quot;&gt;assign&lt;/span&gt;(&amp;#123;&amp;#125;, routeProps, attrs, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                onVnodeUnmounted,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;ref&lt;/span&gt;: viewRef,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;title function_&quot;&gt;normalizeSlot&lt;/span&gt;(slots.&lt;span class=&quot;property&quot;&gt;default&lt;/span&gt;, &amp;#123; &lt;span class=&quot;title class_&quot;&gt;Component&lt;/span&gt;: component, route &amp;#125;) ||&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                component);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
"><meta name="twitter:image"><title>Week28-脚手架发布模块架构设计和核心流程开发 | 六个周</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.3"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + '912656f1f71687bc80e68bfc7315fc4c';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Week28-脚手架发布模块架构设计和核心流程开发</h1><a id="logo" href="/.">六个周</a><p class="description">一个人只有一种命运，早日相遇，尽情拥抱。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> Me</i></a><a target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa fa-subway"> 开往</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Week28-脚手架发布模块架构设计和核心流程开发</h1><div class="post-meta">2021-07-01<span> | </span><span class="category"><a href="/categories/Web%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%84%9A%E6%89%8B%E6%9E%B6/">Web架构之脚手架</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.2k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 19</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" href="/Week28-%E8%84%9A%E6%89%8B%E6%9E%B6%E5%8F%91%E5%B8%83%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B%E5%BC%80%E5%8F%91/#vcomment"><span class="valine-comment-count" data-xid="/Week28-%E8%84%9A%E6%89%8B%E6%9E%B6%E5%8F%91%E5%B8%83%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B%E5%BC%80%E5%8F%91/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E5%91%A8%E4%BB%8B%E7%BB%8D"><span class="toc-text">第一章：周介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%84%9A%E6%89%8B%E6%9E%B6%E5%8F%91%E5%B8%83%E6%B5%81%E7%A8%8B%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">第二章：脚手架发布流程架构设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9Aimooc-cli%E8%84%9A%E6%89%8B%E6%9E%B6git-flow-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">第三章：imooc-cli脚手架git flow 自动化架构设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-imooc-cli-%E8%84%9A%E6%89%8B%E6%9E%B6%E4%BA%91%E6%9E%84%E5%BB%BA-%E4%BA%91%E5%8F%91%E5%B8%83%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">第四章 imooc-cli 脚手架云构建 + 云发布架构设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9Aimooc-cli%E8%84%9A%E6%89%8B%E6%9E%B6publish%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91"><span class="toc-text">第五章：imooc-cli脚手架publish模块开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E6%9C%AC%E5%91%A8%E5%8A%A0%E9%A4%90%EF%BC%9A%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F%E5%8E%9F%E7%90%86%E5%92%8C-vue-router-%E6%BA%90%E7%A0%81%E8%AE%B2%E8%A7%A3"><span class="toc-text">第六章 本周加餐：前端路由模式原理和 vue-router 源码讲解</span></a></li></ol></div></div><div class="post-content"><p><font color=blue>更新说明：对文章目录排版做了调整。</font><br>
<font color=blue> 更新时间：2022-05-04</font></p>
<h2 id="第一章：周介绍">第一章：周介绍</h2>
<blockquote>
<ul>
<li>掌握脚手架发布模块的整体架构设计和实现原理</li>
<li>掌握前端发布流程，并了解history和hash两种路由模式的区别</li>
<li>深入理解vue-router原理</li>
</ul>
</blockquote>
<p><strong>关键词</strong></p>
<blockquote>
<ul>
<li>前端发布</li>
<li>前端路由</li>
<li>vue-router</li>
</ul>
</blockquote>
<h2 id="第二章：脚手架发布流程架构设计">第二章：脚手架发布流程架构设计</h2>
<p><strong>2-1  脚手架发布功能和流程讲解</strong></p>
<blockquote>
<ul>
<li>不依靠后端或服务端人员，使用脚手架快速对更改的内容进行项目发布。</li>
<li>imooc-cli --packagePath /Users/liumingzhou/Desktop/imooc-cli/packages/publish
<ul>
<li>git配置检查：保证远程仓库存在</li>
<li>git自动提交(输入commit信息)：避免本地代码提交的繁杂操作</li>
<li>云构建+云发布：检查build结果、按照依赖、云构建、云发布、云断开</li>
</ul>
</li>
</ul>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.processon.com/embed/60f240e1e401fd4fe0531bef">点击查看【processon】</a></p>
<p><strong>2-2 绘制项目发布架构设计图</strong><br>
<img src="https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-1.7b7b0edh7fs0.webp" alt="28-1"></p>
<h2 id="第三章：imooc-cli脚手架git-flow-自动化架构设计">第三章：imooc-cli脚手架git flow 自动化架构设计</h2>
<p><strong>3-1 git flow 基础流程讲解</strong></p>
<blockquote>
<ul>
<li>git flow是2010年 Vincent Driessen设计出来的。</li>
</ul>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.processon.com/embed/60f2487c1efad41bbea86894">点击查看【processon】</a></p>
<p><strong>3-2 git flow 多人协作流程讲解（详细讲解大厂git flow流程)</strong><br>
<a target="_blank" rel="noopener" href="https://www.processon.com/embed/60f250be0e3e7453927475af">点击查看【processon】</a></p>
<p><strong>3-3 脚手架git flow prepare阶段架构设计</strong></p>
<blockquote>
<p>ProcessOn画图</p>
</blockquote>
<p><strong>3-4 脚手架git flow 执行阶段架构设计 -Init</strong></p>
<blockquote>
<p>ProcessOn画图</p>
</blockquote>
<h2 id="第四章-imooc-cli-脚手架云构建-云发布架构设计">第四章 imooc-cli 脚手架云构建 + 云发布架构设计</h2>
<p><strong>4-1 云构建+云发布整体流程设计</strong><br>
<strong>4-2 云构建+云发布详细流程设计1</strong><br>
<strong>4-3 云构建+云发布详细流程设计2</strong><br>
<strong>4-4 深入讲解云发布原理</strong><br>
<a target="_blank" rel="noopener" href="https://www.processon.com/embed/60f258a11e085376da5a1525">点击查看【processon】</a></p>
<h2 id="第五章：imooc-cli脚手架publish模块开发">第五章：imooc-cli脚手架publish模块开发</h2>
<p><strong>5-1 创建publish模块</strong></p>
<blockquote>
<p>本模块在调试的时候出现问题：</p>
<ul>
<li>lerna create @cloudscope-cli/publish commands</li>
<li>publish模块下lib的index中，打印日志：console.log(‘publish’)</li>
<li>接着使用webstorm调试exec的时候，debug没有进去。</li>
<li>参数为：
<ul>
<li>Node parameters:<strong>/Users/liumingzhou/Documents/imoocCourse/Web前端架构师/cloudscope-cli/core/cli/bin/index.js  publish  --targetPath /Users/liumingzhou/Documents/imoocCourse/Web前端架构师/cloudscope-cli/commands/publish</strong></li>
<li>Working directory: <strong>~/Desktop/test</strong></li>
</ul>
</li>
</ul>
</blockquote>
<p>查找原因为：</p>
<blockquote>
<ul>
<li>首先将本地连接全部去除 ： 进入到node的modules目录下将相关的脚手架liugezhou的cloudscope的全部删除</li>
<li>进入到cloudscope-cli/core/cli 下npm install
<ul>
<li>发现在utils下等有一些package2的包，于是去到相关包下，删除重新安装</li>
</ul>
</li>
<li>npm install正确后，npm link，link完毕之后在本地which cloudscole-cli 看到有了包</li>
<li>然后在webstorm中调试的  Node parameters中重新配置(在publish之前加空格)</li>
</ul>
</blockquote>
<blockquote>
<p>最后在一个空目录中输入以下命令进行调试：<br>
cloudscope-cli publish --targetPath /Users/liumingzhou/Documents/imoocCourse/Web前端架构师/cloudscope-cli/commands/publish<br>
打印出：publish</p>
</blockquote>
<p><strong>5-2 publish基本流程开发</strong></p>
<blockquote>
<p>接下来的重点就是编写业务代码：cloudscope-cli/commands/publish/lib/index.js</p>
<ul>
<li>参考init中的代码，extends Command</li>
<li>必须实现init和exec方法，否则报错</li>
<li>该文件中用到的log / Command等需要npm install引入</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Command</span> = <span class="built_in">require</span>(<span class="string">&#x27;@cloudscope-cli/command&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> log = <span class="built_in">require</span>(<span class="string">&#x27;@cloudscope-cli/log&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PublishCommand</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Command</span> &#123;</span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 处理参数</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;init&#x27;</span>,<span class="variable language_">this</span>.<span class="property">_argv</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">exec</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> startTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">            <span class="comment">//1. 初始化检查</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">prepare</span>()</span><br><span class="line">            <span class="comment">//2.Git Flow自动化</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.云构建 + 云发布</span></span><br><span class="line">            <span class="keyword">const</span> endTime = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">            log.<span class="title function_">info</span>(<span class="string">&#x27;本次发布耗时&#x27;</span>,<span class="title class_">Math</span>.<span class="title function_">floor</span>(endTime-startTime)/<span class="number">1000</span>+<span class="string">&#x27;秒&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            log.<span class="title function_">error</span>(e.<span class="property">message</span>)</span><br><span class="line">            <span class="keyword">if</span>(process.<span class="property">env</span>.<span class="property">LOG_LEVEL</span> === <span class="string">&#x27;verbose&#x27;</span>)&#123;</span><br><span class="line">                log.<span class="title function_">error</span>(e.<span class="property">message</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="title function_">prepare</span>(<span class="params"></span>)&#123;</span><br><span class="line">    </span><br><span class="line">	 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">argv</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PublishCommand</span>(argv)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = init</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">PublishCommand</span> = <span class="title class_">PublishCommand</span>;</span><br></pre></td></tr></table></figure>
<p><strong>5-3 项目发布前预检查流程开发</strong></p>
<blockquote>
<p>结合上一节代码，本节主要内容为：</p>
<ul>
<li>初始化检查prepare
<ul>
<li>确认项目是否npm项目</li>
<li>确认项目的package.json中是否包含name/version/scripts/scripts.build</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">prepare</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 1.确认项目是否为npm项目</span></span><br><span class="line">  <span class="keyword">const</span> projectPath =  process.<span class="title function_">cwd</span>()</span><br><span class="line">  <span class="keyword">const</span> pkgPath = path.<span class="title function_">resolve</span>(projectPath,<span class="string">&#x27;package.json&#x27;</span>)</span><br><span class="line">  log.<span class="title function_">verbose</span>(<span class="string">&#x27;package.json&#x27;</span>,pkgPath)</span><br><span class="line">  <span class="keyword">if</span>(!fs.<span class="title function_">existsSync</span>(pkgPath))&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;package.json不存在&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//2. 确认是否包含name\version\build命令</span></span><br><span class="line">  <span class="keyword">const</span> pkg = fse.<span class="title function_">readJsonSync</span>(pkgPath)</span><br><span class="line">  <span class="keyword">const</span> &#123;name,version,scripts&#125; = pkg</span><br><span class="line">  <span class="keyword">if</span>(!name || !version || !scripts || !scripts.<span class="property">build</span> )&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;package.json信息不全，请检查是否存在name、version和scripts(需提供build命令)&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">projectInfo</span> = &#123;name,version,<span class="attr">dir</span>:projectPath&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第六章-本周加餐：前端路由模式原理和-vue-router-源码讲解">第六章 本周加餐：前端路由模式原理和 vue-router 源码讲解</h2>
<p><strong>本章内容测试代码上传至：</strong><a target="_blank" rel="noopener" href="https://github.com/liugezhou/vue-router-demo">https://github.com/liugezhou/vue-router-demo</a></p>
<p><strong>6-1 vue-router-next完整运行流程解析</strong></p>
<blockquote>
<p><strong>vue-router-next源码解析</strong><br>
vue-router常见问题：</p>
<ul>
<li>history和hash模式的区别是什么（涉及vue-router路由模式和前端发布原理）</li>
<li>Vue dev模式下为什么不需要配置history fallback(涉及webpack-dev-server配置)</li>
<li>我们没有定义router-link和router-view，为什么代码里能直接使用(涉及vue-router初始化流程和Vue插件)</li>
<li>浏览器如何实现URL变化但页面不刷新(涉及vue-router history模式核心实现原理)</li>
<li>vue-router如何实现路由匹配(涉及 vue-router Matcher 实现原理)</li>
<li>router-view如何实现组件动态渲染？(涉及Vue动态组件)</li>
</ul>
</blockquote>
<p>通过imooc-cli脚手架安装一个vue3标准模版</p>
<blockquote>
<ul>
<li>npm install -g @imooc-cli/core</li>
<li>imooc-cli init test</li>
<li>npm install -S vue-router（package.json中安装的版本为3.5.2，我们需要手动改成4.0.0-0,然后安装）</li>
<li>新建三个组件  src/pages/Home.vue | src/pages/Order.vue | src/pages/My.vue</li>
<li>新建src/router.js</li>
<li>并在main.js中引入，app.use(router)</li>
<li>在App.vue中使用<router-link/>和<router-view/></li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/router.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;createWebHistory,createRouter&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>,</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;./pages/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">My</span> <span class="keyword">from</span> <span class="string">&#x27;./pages/My&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Order</span> <span class="keyword">from</span> <span class="string">&#x27;./pages/Order&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&#x27;/&#x27;</span>,<span class="attr">name</span>:<span class="string">&#x27;root&#x27;</span>,<span class="attr">redirect</span>:<span class="string">&#x27;/home&#x27;</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span>,<span class="attr">name</span>:<span class="string">&#x27;home&#x27;</span>,<span class="attr">component</span>:<span class="title class_">Home</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&#x27;/my&#x27;</span>,<span class="attr">name</span>:<span class="string">&#x27;my&#x27;</span>,<span class="attr">component</span>:<span class="title class_">My</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">path</span>:<span class="string">&#x27;/order&#x27;</span>,<span class="attr">name</span>:<span class="string">&#x27;order&#x27;</span>,<span class="attr">component</span>:<span class="title class_">Order</span></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routerHitory = <span class="title function_">createWebHistory</span>()</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">	<span class="attr">history</span>:routerHitory,</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;vue3&quot;</span>&gt;</span>vue3 template<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&#x27;/home&#x27;</span>&gt;</span>Home | <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&#x27;/order&#x27;</span>&gt;</span>Order | <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&#x27;/my&#x27;</span>&gt;</span>My | <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;Vue3&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-id">#vue3</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>6-2 vue-router路由模式+history路由部署详细教学</strong></p>
<p><strong>Vue-router路由模式</strong></p>
<blockquote>
<ul>
<li>hash：createWebHashHistory()</li>
<li>history：createWebHistory()</li>
</ul>
</blockquote>
<p>hash和history模式的区别</p>
<blockquote>
<ul>
<li>语法结构不同 ：hash添加#意味着一个辅助说明，#后面参数发送改变后并不会加载资源，history模式只要路径改变就会重新请求资源，但是如果页面刷新的话 hash和history都是会重新加载资源的。</li>
<li>部署方式不同(history部署)
<ul>
<li>npm run build</li>
<li>nginx 静态网站服务器配置文件如下</li>
<li>localhost:8081访问后，换不同的路由，页面刷新会显示404</li>
<li>此时根据Vue文档，Fallback，在nginx配置文件需要加入如下一行代码</li>
<li>try_files: $uri  $uri/ /index.html;</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen       <span class="number">8081</span>;</span><br><span class="line">       server_name resource;</span><br><span class="line">       root /<span class="title class_">Users</span>/liumingzhou/<span class="variable constant_">XXXXX</span>/dist;</span><br><span class="line">       autoindex on;</span><br><span class="line">       location / &#123;</span><br><span class="line">         <span class="comment">//跨域设置</span></span><br><span class="line">          add_header  <span class="title class_">Access</span>-<span class="title class_">Control</span>-<span class="title class_">Allow</span>-<span class="title class_">Origin</span> *;</span><br><span class="line">          <span class="attr">try_files</span>: $uri  $uri/ /index.<span class="property">html</span>;</span><br><span class="line">       &#125;</span><br><span class="line">			  <span class="comment">// 缓存设置</span></span><br><span class="line">       add_header   <span class="title class_">Cache</span>-<span class="title class_">Control</span> <span class="string">&quot;no-cache, must-revalidate&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>SEO：hash不友好,实际开发应用为history模式。</li>
<li>history模式跳转，利用的是浏览器对象中的history.pushState/replaceState/back/go/forward</li>
<li>hash模式跳转，利用的是浏览器对象中的location.href</li>
</ul>
</blockquote>
<p><strong>6-3 vue-cli源码调试+dev模式history fallback原理讲解</strong></p>
<p><strong>为什么Vue的dev模式下不需要配置history fallback？</strong></p>
<blockquote>
<ul>
<li>说明：我们在dev模式下启动项目：npm run serve,在scripts中serve，实际执行的命令是  vue-cli-service serve,这个时候我们调试源码就在<strong>node_modules/.bin/vue-cli-service</strong>。如果执行全局 vue create，调试该命令的话我们就需要去本地全局安装的vue源码中去调试。</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>这个<strong>node_modules/.bin/vue-cli-service</strong>其实是link文件，我们通过 <strong>ll node_modules/.bin/vue-cli-service</strong> 就可以看出来。=》…/@vue/cli-service/bin/vue-cli-service.js</li>
<li>在webstorm中新建Node.js调试，Node parameters为：./node_modules/@vue/cli-service/bin/vue-cli-service.js serve</li>
<li>然后在上面的文件中打断点，开始进入debug调试模式。</li>
<li>跟着视频课程的调试，核心代码就是webpack的genHistoryApiFallbackRewrites 与try_files一样的作用</li>
</ul>
</blockquote>
<p><strong>6-4 vue-router初始化过程源码分析</strong></p>
<p><strong>我们并没有定义router-link和router-view，为什么代码里能直接使用？</strong></p>
<blockquote>
<ul>
<li>在vscode的router.js中添加debugger调试，没起作用，因此，该源码的调试是在webstorm中debug的。</li>
</ul>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-2.20o3twc8o868.webp" alt="28-2"></p>
<blockquote>
<ul>
<li>项目启动之后，打开浏览器，点击刷新，会进入到调试处</li>
</ul>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-3.5q03uo6szog.webp" alt="28-3"></p>
<blockquote>
<ul>
<li>首先进入到<strong>createWebHistory</strong>方法中去(上图第21行代码)，返回的routerHistory提供了一系列的工具方法(路由跳转、监听的事件方法等)，具体实现源码以及注释如下：</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createWebHistory</span>(<span class="params">base</span>) &#123;</span><br><span class="line">  <span class="comment">// 传入的base进行处理</span></span><br><span class="line">    base = <span class="title function_">normalizeBase</span>(base);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//historyNavigation提供了一些方法：location/push/replace/state</span></span><br><span class="line">  <span class="comment">// 该方法的实现浏览器URL变化但页面不刷新（push），核心是使用了浏览器对象模型history.pushState()和history.replaceState()方法。</span></span><br><span class="line">    <span class="keyword">const</span> historyNavigation = <span class="title function_">useHistoryStateNavigation</span>(base);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//生成一个listener：destory和listen方法</span></span><br><span class="line">    <span class="keyword">const</span> historyListeners = <span class="title function_">useHistoryListeners</span>(base, historyNavigation.<span class="property">state</span>, historyNavigation.<span class="property">location</span>, historyNavigation.<span class="property">replace</span>);</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">go</span>(<span class="params">delta, triggerListeners = <span class="literal">true</span></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!triggerListeners)</span><br><span class="line">            historyListeners.<span class="title function_">pauseListeners</span>();</span><br><span class="line">        history.<span class="title function_">go</span>(delta);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//将上面的事件拼装到一起，生成一个routerHistory对象返回</span></span><br><span class="line">    <span class="keyword">const</span> routerHistory = <span class="title function_">assign</span>(&#123;</span><br><span class="line">        <span class="comment">// it&#x27;s overridden right after</span></span><br><span class="line">        <span class="attr">location</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        base,</span><br><span class="line">        go,</span><br><span class="line">        <span class="attr">createHref</span>: createHref.<span class="title function_">bind</span>(<span class="literal">null</span>, base),</span><br><span class="line">    &#125;, historyNavigation, historyListeners);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(routerHistory, <span class="string">&#x27;location&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">get</span>: <span class="function">() =&gt;</span> historyNavigation.<span class="property">location</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(routerHistory, <span class="string">&#x27;state&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">get</span>: <span class="function">() =&gt;</span> historyNavigation.<span class="property">state</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> routerHistory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>返回routerHistory对象后，接着进入到<strong>createRouter</strong>方法中，源码以及注释如下：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从调用createRouter处，options中传入的参数为：history和routes</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createRouter</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="comment">// 第一步生成matcher，matcher的作用是实现路由匹配</span></span><br><span class="line">  <span class="comment">// createRouterMatcher会为每一个简单或复杂的路由生成一个正则表达式</span></span><br><span class="line">    <span class="keyword">const</span> matcher = <span class="title function_">createRouterMatcher</span>(options.<span class="property">routes</span>, options);</span><br><span class="line">    <span class="keyword">let</span> parseQuery$1 = options.<span class="property">parseQuery</span> || parseQuery;</span><br><span class="line">    <span class="keyword">let</span> stringifyQuery$1 = options.<span class="property">stringifyQuery</span> || stringifyQuery;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 拿到history对象，是createWebHistory或者为createWebHashHistory</span></span><br><span class="line">    <span class="keyword">let</span> routerHistory = options.<span class="property">history</span>;</span><br><span class="line">    <span class="keyword">if</span> ((process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &amp;&amp; !routerHistory)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Provide the &quot;history&quot; option when calling &quot;createRouter()&quot;:&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27; https://next.router.vuejs.org/api/#history.&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//一些路由守卫的初始化、useCallbacks方法返回一个闭包。</span></span><br><span class="line">  <span class="comment">//每一个路由守卫都对应了一个闭包(代码就不贴了，主要返回了三个方法：add,list,reset,主要作用是缓存路由守卫)。</span></span><br><span class="line">    <span class="keyword">const</span> beforeGuards = <span class="title function_">useCallbacks</span>();</span><br><span class="line">    <span class="keyword">const</span> beforeResolveGuards = <span class="title function_">useCallbacks</span>();</span><br><span class="line">    <span class="keyword">const</span> afterGuards = <span class="title function_">useCallbacks</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 生成默认router</span></span><br><span class="line">    <span class="keyword">const</span> currentRoute = <span class="title function_">shallowRef</span>(<span class="variable constant_">START_LOCATION_NORMALIZED</span>);</span><br><span class="line"></span><br><span class="line">………………</span><br><span class="line"><span class="comment">//  一些初始化操作</span></span><br><span class="line">………………</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 这里的router即为最终的router对象，包含一系列的属性和方法</span></span><br><span class="line">    <span class="keyword">const</span> router = &#123;</span><br><span class="line">        currentRoute,</span><br><span class="line">        addRoute,</span><br><span class="line">        removeRoute,</span><br><span class="line">        hasRoute,</span><br><span class="line">        getRoutes,</span><br><span class="line">        resolve,</span><br><span class="line">        options,</span><br><span class="line">        push,</span><br><span class="line">        replace,</span><br><span class="line">        go,</span><br><span class="line">        <span class="attr">back</span>: <span class="function">() =&gt;</span> <span class="title function_">go</span>(-<span class="number">1</span>),</span><br><span class="line">        <span class="attr">forward</span>: <span class="function">() =&gt;</span> <span class="title function_">go</span>(<span class="number">1</span>),</span><br><span class="line">        <span class="attr">beforeEach</span>: beforeGuards.<span class="property">add</span>,</span><br><span class="line">        <span class="attr">beforeResolve</span>: beforeResolveGuards.<span class="property">add</span>,</span><br><span class="line">        <span class="attr">afterEach</span>: afterGuards.<span class="property">add</span>,</span><br><span class="line">        <span class="attr">onError</span>: errorHandlers.<span class="property">add</span>,</span><br><span class="line">        isReady,</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//此处的install方法是在执行app.user(router)的时候会执行到这里(即当这个router被返回到main.js后，下一步就会执行app.user(router),然后就会进入到这方法中去)</span></span><br><span class="line">        <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> router = <span class="variable language_">this</span>;</span><br><span class="line">          </span><br><span class="line">          <span class="comment">//在此处注册了组件RouterLink和RouterView</span></span><br><span class="line">            app.<span class="title function_">component</span>(<span class="string">&#x27;RouterLink&#x27;</span>, <span class="title class_">RouterLink</span>);</span><br><span class="line">            app.<span class="title function_">component</span>(<span class="string">&#x27;RouterView&#x27;</span>, <span class="title class_">RouterView</span>);</span><br><span class="line">          </span><br><span class="line">          <span class="comment">//全局主注册了$router $route</span></span><br><span class="line">            app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$router</span> = router;</span><br><span class="line">            <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(app.<span class="property">config</span>.<span class="property">globalProperties</span>, <span class="string">&#x27;$route&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">get</span>: <span class="function">() =&gt;</span> <span class="title function_">unref</span>(currentRoute),</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span> (isBrowser &amp;&amp;!started &amp;&amp;</span><br><span class="line">                currentRoute.<span class="property">value</span> === <span class="variable constant_">START_LOCATION_NORMALIZED</span>) &#123;</span><br><span class="line">                started = <span class="literal">true</span>;</span><br><span class="line">              </span><br><span class="line">              <span class="comment">//浏览器中push后，就会进行页面的渲染</span></span><br><span class="line">                <span class="title function_">push</span>(routerHistory.<span class="property">location</span>).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>))</span><br><span class="line">                        <span class="title function_">warn</span>(<span class="string">&#x27;Unexpected error when starting the router:&#x27;</span>, err);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> reactiveRoute = &#123;&#125;;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> <span class="variable constant_">START_LOCATION_NORMALIZED</span>) &#123;</span><br><span class="line">                reactiveRoute[key] = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> currentRoute.<span class="property">value</span>[key]);</span><br><span class="line">            &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="comment">// 使用app.provide来做组件的传递</span></span><br><span class="line">          <span class="comment">// router-view和router-link中的参数是通过这里传递下去的</span></span><br><span class="line">          <span class="comment">// 关于provide的用法，见本节内容往下</span></span><br><span class="line">            app.<span class="title function_">provide</span>(routerKey, router);</span><br><span class="line">            app.<span class="title function_">provide</span>(routeLocationKey, <span class="title function_">reactive</span>(reactiveRoute));</span><br><span class="line">            app.<span class="title function_">provide</span>(routerViewLocationKey, currentRoute);</span><br><span class="line">            <span class="keyword">let</span> unmountApp = app.<span class="property">unmount</span>;</span><br><span class="line">            installedApps.<span class="title function_">add</span>(app);</span><br><span class="line">            app.<span class="property">unmount</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                installedApps.<span class="title function_">delete</span>(app);</span><br><span class="line">                <span class="keyword">if</span> (installedApps.<span class="property">size</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="title function_">removeHistoryListener</span>();</span><br><span class="line">                    currentRoute.<span class="property">value</span> = <span class="variable constant_">START_LOCATION_NORMALIZED</span>;</span><br><span class="line">                    started = <span class="literal">false</span>;</span><br><span class="line">                    ready = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">unmountApp</span>();</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> router;</span><br></pre></td></tr></table></figure>
<p><strong>6-5 vue3高级特性：vue插件+provide跨组件通信</strong></p>
<p><strong>浏览器中如何实现URL变化但页面不刷新</strong></p>
<blockquote>
<ul>
<li>在控制台直接输入  history.pushState(null,null,‘/Order’/),会发现浏览器窗口中地址发生了改变，但页面未刷新。</li>
<li>onpopState事件主要用来监听路由回退的操作。</li>
<li>调试源码的步骤是，写一个click方法，点击debuger进行操作</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @click=<span class="string">&quot;jump&quot;</span>&gt;<span class="title class_">Jump</span>&lt;/button&gt;</span><br><span class="line">………………</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">      <span class="title function_">jump</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// eslint-disable-next-line no-debugger</span></span><br><span class="line">        <span class="keyword">debugger</span></span><br><span class="line">        router.<span class="title function_">push</span>(<span class="string">&#x27;/order&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>然后step into到router.push方法中，由此开始调试，进入pushWithRedirect()方法中(如下图)<br>
<img src="https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-4.4fsku45pmnw0.webp" alt="28-4"><br>
然后一步一步的，调试源码到最后，最终会通过history.pushState()方法，来改变地址而不发生页面的更新。</p>
</blockquote>
<p>在上图的高亮部分resolve(to)是路由匹配的相关实现，下节继续。</p>
<p><strong>6-7 vue-router路由匹配源码分析</strong></p>
<blockquote>
<p>我们输入路由后如何与我们自己定义的 routes中的路由进行匹配，就涉及到vue-router的核心概念 matcher。<br>
两个关键点是：createRouter以及上一节提到的resollve方法。<br>
<img src="https://cdn.jsdelivr.net/gh/liugezhou/image@master/imooc-course/28-5.6g8w1s5ubqc0.webp" alt="28-5"></p>
</blockquote>
<blockquote>
<p>本节重点讲解这个resolve方法，我们假定从 /home跳转到/order，代码以及注释如下：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">rawLocation, currentLocation</span>) &#123;</span><br><span class="line">  <span class="comment">// 第一步是拿到currentLocation，即当前路由相关信息 【/home相关的】</span></span><br><span class="line">        currentLocation = <span class="title function_">assign</span>(&#123;&#125;, currentLocation || currentRoute.<span class="property">value</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 判断传进来的路由‘/order’参数是不是string</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> rawLocation === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">          </span><br><span class="line">          <span class="comment">//进行一个形式的格式化吧</span></span><br><span class="line">            <span class="keyword">let</span> locationNormalized = <span class="title function_">parseURL</span>(parseQuery$1, rawLocation, currentLocation.<span class="property">path</span>);</span><br><span class="line">          </span><br><span class="line">          <span class="comment">//最关键的一步是调用matcher下的resolve方法，传入两个参数 ‘/order’和‘/home’，到这里我们需要继续step into到这个方法中去调试。关键代码为： matchers.find(m =&gt; m.re.test(path)); </span></span><br><span class="line">            <span class="keyword">let</span> matchedRoute = matcher.<span class="title function_">resolve</span>(&#123; <span class="attr">path</span>: locationNormalized.<span class="property">path</span> &#125;, currentLocation);</span><br><span class="line">            <span class="keyword">let</span> href = routerHistory.<span class="title function_">createHref</span>(locationNormalized.<span class="property">fullPath</span>);</span><br><span class="line">            <span class="keyword">if</span> ((process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (href.<span class="title function_">startsWith</span>(<span class="string">&#x27;//&#x27;</span>))</span><br><span class="line">                    <span class="title function_">warn</span>(<span class="string">`Location &quot;<span class="subst">$&#123;rawLocation&#125;</span>&quot; resolved to &quot;<span class="subst">$&#123;href&#125;</span>&quot;. A resolved location cannot start with multiple slashes.`</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!matchedRoute.<span class="property">matched</span>.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="title function_">warn</span>(<span class="string">`No match found for location with path &quot;<span class="subst">$&#123;rawLocation&#125;</span>&quot;`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// locationNormalized is always a new object</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">assign</span>(locationNormalized, matchedRoute, &#123;</span><br><span class="line">                <span class="attr">params</span>: <span class="title function_">decodeParams</span>(matchedRoute.<span class="property">params</span>),</span><br><span class="line">                <span class="attr">hash</span>: <span class="title function_">decode</span>(locationNormalized.<span class="property">hash</span>),</span><br><span class="line">                <span class="attr">redirectedFrom</span>: <span class="literal">undefined</span>,</span><br><span class="line">                href,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        …………………………………………</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>6-8 vue3新特性defineComponent讲解1 &amp;&amp; 6-9 vue3新特性defineComponent讲解2</strong></p>
<p><strong>router-view如何实现组件动态渲染(涉及Vue动态组件)</strong></p>
<blockquote>
<ul>
<li>本节从router对象的install方法开始，找到 app.component(‘RouterView’,RouterView)。</li>
<li>2328行定义：const RouterView = RouterViewImpl;</li>
<li>RouterView就是RouterViewImpl方法，该方法源码如下</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>通过** 6-10 <strong>章节所示源码，我们看到router-view组件是以纯js实现的方式，使用</strong>defineComponent<strong>定义组件，组件的渲染使用了</strong>h**函数。</li>
<li>在进一步看源码之前，我们先来写个demo看  如何使用纯js方式编写组件。</li>
<li><em>h 函数包含的三个参数为：dom标签、dom中需要绑定的一些属性、dom当中的children。</em></li>
<li>下面为代码演示，注释部分为直接使用Home组件的渲染。</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent,h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">// import  Home from &#x27;../pages/Home&#x27;;</span></span><br><span class="line"> <span class="keyword">const</span> <span class="title class_">TestComponent2</span> = <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;TestComponent2&#x27;</span>,</span><br><span class="line">    <span class="attr">props</span>:&#123;&#125;,</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params">props, &#123;slots&#125; </span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">()=&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>,&#123;</span><br><span class="line">                <span class="attr">class</span>:<span class="string">&#x27;test-component2&#x27;</span>,</span><br><span class="line">                <span class="title function_">onClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,slots.<span class="title function_">default</span>())</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// return () =&gt;&#123;</span></span><br><span class="line">        <span class="comment">//     return h(Home,&#123;</span></span><br><span class="line">        <span class="comment">//         onClick()&#123;</span></span><br><span class="line">        <span class="comment">//             alert(&#x27;You Clicked the Home Component!&#x27;)</span></span><br><span class="line">        <span class="comment">//         &#125;</span></span><br><span class="line">        <span class="comment">//     &#125;)</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">TestComponent2</span></span><br></pre></td></tr></table></figure>
<p><strong>6-10 深入解析router-view源码</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">RouterViewImpl</span> = <span class="comment">/*#__PURE__*/</span> <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;RouterView&#x27;</span>,</span><br><span class="line">    <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="string">&#x27;default&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">route</span>: <span class="title class_">Object</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  <span class="comment">// setup在整个组件初始化的时候只会执行一遍，但下面的render function，也就是40行的return部分会执行多次</span></span><br><span class="line">    <span class="title function_">setup</span>(<span class="params">props, &#123; attrs, slots &#125;</span>) &#123;</span><br><span class="line">        (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &amp;&amp; <span class="title function_">warnDeprecatedUsage</span>();</span><br><span class="line">      <span class="comment">// injectedRoute决定router-view的刷新</span></span><br><span class="line">        <span class="keyword">const</span> injectedRoute = <span class="title function_">inject</span>(routerViewLocationKey);</span><br><span class="line">      <span class="comment">// injectedRoute.value</span></span><br><span class="line">        <span class="keyword">const</span> routeToDisplay = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> props.<span class="property">route</span> || injectedRoute.<span class="property">value</span>);</span><br><span class="line">        <span class="keyword">const</span> depth = <span class="title function_">inject</span>(viewDepthKey, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">const</span> matchedRouteRef = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> routeToDisplay.<span class="property">value</span>.<span class="property">matched</span>[depth]);</span><br><span class="line">        <span class="title function_">provide</span>(viewDepthKey, depth + <span class="number">1</span>);</span><br><span class="line">        <span class="title function_">provide</span>(matchedRouteKey, matchedRouteRef);</span><br><span class="line">        <span class="title function_">provide</span>(routerViewLocationKey, routeToDisplay);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 空的ref用来装载马上要渲染的view-router实例</span></span><br><span class="line">        <span class="keyword">const</span> viewRef = <span class="title function_">ref</span>();</span><br><span class="line">        <span class="title function_">watch</span>(<span class="function">() =&gt;</span> [viewRef.<span class="property">value</span>, matchedRouteRef.<span class="property">value</span>, props.<span class="property">name</span>], <span class="function">(<span class="params">[instance, to, name], [oldInstance, <span class="keyword">from</span>, oldName]</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (to) &#123;</span><br><span class="line">                to.<span class="property">instances</span>[name] = instance;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">from</span> &amp;&amp; <span class="keyword">from</span> !== to &amp;&amp; instance &amp;&amp; instance === oldInstance) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!to.<span class="property">leaveGuards</span>.<span class="property">size</span>) &#123;</span><br><span class="line">                        to.<span class="property">leaveGuards</span> = <span class="keyword">from</span>.<span class="property">leaveGuards</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (!to.<span class="property">updateGuards</span>.<span class="property">size</span>) &#123;</span><br><span class="line">                        to.<span class="property">updateGuards</span> = <span class="keyword">from</span>.<span class="property">updateGuards</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (instance &amp;&amp;</span><br><span class="line">                to &amp;&amp;</span><br><span class="line">                (!<span class="keyword">from</span> || !<span class="title function_">isSameRouteRecord</span>(to, <span class="keyword">from</span>) || !oldInstance)) &#123;</span><br><span class="line">                (to.<span class="property">enterCallbacks</span>[name] || []).<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> <span class="title function_">callback</span>(instance));</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="comment">// 默认为pre属性，post在页面渲染之后执行 watch 监听</span></span><br><span class="line">        &#125;, &#123; <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span> &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> route = routeToDisplay.<span class="property">value</span>;</span><br><span class="line">            <span class="keyword">const</span> matchedRoute = matchedRouteRef.<span class="property">value</span>;</span><br><span class="line">            <span class="keyword">const</span> <span class="title class_">ViewComponent</span> = matchedRoute &amp;&amp; matchedRoute.<span class="property">components</span>[props.<span class="property">name</span>];</span><br><span class="line">            <span class="keyword">const</span> currentName = props.<span class="property">name</span>;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">ViewComponent</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">normalizeSlot</span>(slots.<span class="property">default</span>, &#123; <span class="title class_">Component</span>: <span class="title class_">ViewComponent</span>, route &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> routePropsOption = matchedRoute.<span class="property">props</span>[props.<span class="property">name</span>];</span><br><span class="line">            <span class="keyword">const</span> routeProps = routePropsOption</span><br><span class="line">                ? routePropsOption === <span class="literal">true</span></span><br><span class="line">                    ? route.<span class="property">params</span></span><br><span class="line">                    : <span class="keyword">typeof</span> routePropsOption === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">                        ? <span class="title function_">routePropsOption</span>(route)</span><br><span class="line">                        : routePropsOption</span><br><span class="line">                : <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">onVnodeUnmounted</span> = vnode =&gt; &#123;</span><br><span class="line">                <span class="comment">// remove the instance reference to prevent leak</span></span><br><span class="line">                <span class="keyword">if</span> (vnode.<span class="property">component</span>.<span class="property">isUnmounted</span>) &#123;</span><br><span class="line">                    matchedRoute.<span class="property">instances</span>[currentName] = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">const</span> component = <span class="title function_">h</span>(<span class="title class_">ViewComponent</span>, <span class="title function_">assign</span>(&#123;&#125;, routeProps, attrs, &#123;</span><br><span class="line">                onVnodeUnmounted,</span><br><span class="line">                <span class="attr">ref</span>: viewRef,</span><br><span class="line">            &#125;));</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">            <span class="title function_">normalizeSlot</span>(slots.<span class="property">default</span>, &#123; <span class="title class_">Component</span>: component, route &#125;) ||</span><br><span class="line">                component);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.3" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.3"><p><span>本文标题：</span>Week28-脚手架发布模块架构设计和核心流程开发</p><p><span>文章作者：</span>六个周</p><p><span>发布时间：</span>2021-07-01</p><p><span>最后更新：</span>2022-05-04</p><p><span>原始链接：</span><a href="/Week28-脚手架发布模块架构设计和核心流程开发/">https://blog.liugezhou.online/Week28-%E8%84%9A%E6%89%8B%E6%9E%B6%E5%8F%91%E5%B8%83%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B%E5%BC%80%E5%8F%91/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://blog.liugezhou.online/Week28-%E8%84%9A%E6%89%8B%E6%9E%B6%E5%8F%91%E5%B8%83%E6%A8%A1%E5%9D%97%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B%E5%BC%80%E5%8F%91/"></i></span></p><p><span>版权声明：</span>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！</p></div><br><div class="tags"><a href="/tags/Web架构之脚手架"><i class="fa fa-tag">Web架构之脚手架</i></a></div><div class="post-nav"><a class="pre" href="/Week29-%E8%84%9A%E6%89%8B%E6%9E%B6%E5%8F%91%E5%B8%83%E6%A8%A1%E5%BC%8Fgit%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%81%E7%A8%8B%E5%BC%80%E5%8F%91/">Week29-脚手架发布模式git自动化流程开发</a><a class="next" href="/Week17-%E7%BC%96%E8%BE%91%E5%99%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%B0%83%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1/">Week17-编辑器服务端调用第三方服务</a></div><div id="vcomment"></div><script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'false' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'Ci6gl5SnXOdXxv9BTlQx3T2F-gzGzoHsz',
  appKey:'bWsfs1hg9qURRp3gJ6SJU41x',
  placeholder:'ヾﾉ≧∀≦)o来啊，快活啊!',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 文章分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web3/">Web3</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%84%9A%E6%89%8B%E6%9E%B6/">Web架构之脚手架</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E5%B0%8F%E6%8A%80/">前端小技</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">博客搭建</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E7%AB%AF/">服务端</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%8F%E5%91%A8%E5%B0%8F%E7%BB%93/">每周小结</a><span class="category-list-count">57</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/">浏览器工作原理</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E4%B9%A6/">读书</a><span class="category-list-count">5</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 其它主页</i></div><ul></ul><a href="https://github.com/liugezhou" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://twitter.com/liugezhou" title="Twitter" target="_blank">Twitter</a><ul></ul><a href="https://chat.liugezhou.online" title="自定义GPT" target="_blank">自定义GPT</a><ul></ul><a href="https://day.liugezhou.online" title="今日前端" target="_blank">今日前端</a><ul></ul><a href="https://run.liugezhou.online" title="Running" target="_blank">Running</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">六个周.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"></a><a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.3" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.3" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.3"><script type="text/javascript" src="/js/search.js?v=1.0.3"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/love.js?v=1.0.3"></script><script type="text/javascript" src="/js/copycode.js?v=1.0.3" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.3"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.3"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.3"></script></div></body></html>